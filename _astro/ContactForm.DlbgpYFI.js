import{j as e,c as x}from"./cn.zzlncTwb.js";import{r as c}from"./index.BmW6Ki2V.js";import{B as P,I as g,T as B}from"./Textarea.-kQNaIpf.js";import{A as H}from"./AddressAutocomplete.CQRvx8Ki.js";import{u as J,L as z,f as W,v as f,a as V,b as K}from"./LegalModal.CIRfRcHK.js";import{s as U}from"./site.config.CN9kl7_B.js";import"./proxy.DU87lMsk.js";import"./createLucideIcon.w0v_EZ4H.js";import"./index.CoPBpCLj.js";function ae({recaptchaSiteKey:s,endpoint:a="/api/contact.php",serviceOptions:r,showAddress:t=!0,className:n,onSuccess:o,onError:i}){const l=r||U.services.map(e=>e.name),[d,m]=c.useState({name:"",email:"",phone:"",address:"",service:"",message:"",website:""}),[p,u]=c.useState({}),[h,v]=c.useState(!1),[j,b]=c.useState(!1),[y,N]=c.useState(!1),[C,w]=c.useState(null),{executeRecaptcha:k,isLoaded:S}=J({siteKey:s,action:"contact_form"}),A=(e,s)=>{m(a=>({...a,[e]:s}));const a=e;p[a]&&u(e=>({...e,[a]:void 0}))};return j?e.jsxs("div",{className:x("rounded-xl bg-success-50 p-8 text-center",n),children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-success-100",children:e.jsx("svg",{className:"h-8 w-8 text-success-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"text-xl font-bold text-success-900",children:"Message Sent!"}),e.jsx("p",{className:"mt-2 text-success-700",children:"Thank you for contacting us. We'll get back to you shortly."}),e.jsx(P,{variant:"outline",className:"mt-6",onClick:()=>b(!1),children:"Send Another Message"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return f(d.name)||(e.name="Name is required"),d.email&&!V(d.email)&&(e.email="Please enter a valid email address"),f(d.phone)?K(d.phone)||(e.phone="Please enter a valid US phone number"):e.phone="Phone number is required",f(d.service)||(e.service="Please select a service"),y||(e.consent="Please agree to be contacted"),u(e),0===Object.keys(e).length})()){if(v(!0),u({}),d.website)return b(!0),void v(!1);try{const e=await k("contact_form");if(!e)throw new Error("reCAPTCHA verification failed. Please try again.");const s=new FormData;s.append("name",d.name),s.append("email",d.email),s.append("phone",W(d.phone)),s.append("address",d.address),s.append("service",d.service),s.append("message",d.message),s.append("recaptcha_token",e);const r=sessionStorage.getItem("marketing_params");if(r)try{const e=JSON.parse(r);Object.keys(e).forEach(a=>{s.append(a,e[a])})}catch(e){console.error("[ContactForm] Error parsing tracking params:",e)}d.addressComponents&&s.append("address_components",JSON.stringify(d.addressComponents));const t=await fetch(a,{method:"POST",body:s}),n=await t.json();if(!t.ok||!n.success)throw new Error(n.message||"Failed to send message");b(!0),m({name:"",email:"",phone:"",address:"",service:"",message:"",website:""}),o&&o(),sessionStorage.setItem("form_submitted","true"),window.location.href="/thank-you/?type=contact"}catch(e){const s=e instanceof Error?e.message:"An error occurred";u({form:s}),i&&i(s)}finally{v(!1)}}},className:x("space-y-6",n),noValidate:!0,children:[p.form&&e.jsx("div",{className:"rounded-lg bg-destructive/10 p-4 text-sm text-destructive",children:p.form}),e.jsx("div",{className:"absolute -left-[9999px]","aria-hidden":"true",children:e.jsx("input",{type:"text",name:"website",value:d.website,onChange:e=>A("website",e.target.value),tabIndex:-1,autoComplete:"off"})}),e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2",children:[e.jsx(g,{label:"Full Name",name:"name",type:"text",placeholder:"John Smith",value:d.name,onChange:e=>A("name",e.target.value),error:p.name,required:!0,autoComplete:"name"}),e.jsx(g,{label:"Email Address",name:"email",type:"email",placeholder:"john@example.com",value:d.email,onChange:e=>A("email",e.target.value),error:p.email,required:!0,autoComplete:"email"})]}),e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2",children:[e.jsx(g,{label:"Phone Number",name:"phone",type:"tel",placeholder:"(555) 000-0000",value:d.phone,onChange:e=>A("phone",e.target.value),error:p.phone,required:!0,autoComplete:"tel"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"service",className:"block text-sm font-medium text-foreground",children:["Service Needed ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("select",{id:"service",name:"service",value:d.service,onChange:e=>A("service",e.target.value),required:!0,className:x("w-full rounded-lg border bg-background px-4 py-3 text-foreground transition-colors","focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20",p.service?"border-destructive focus:border-destructive focus:ring-destructive/20":"border-input"),"aria-invalid":p.service?"true":"false",children:[e.jsx("option",{value:"",children:"Select a service..."}),l.map(s=>e.jsx("option",{value:s,children:s},s))]}),p.service&&e.jsx("p",{className:"text-sm text-destructive",children:p.service})]})]}),t&&e.jsx(H,{name:"address",label:"Service Address",placeholder:"Enter your address",onAddressSelect:e=>{m(s=>({...s,address:e.formattedAddress,addressComponents:e}))},error:p.address}),e.jsx(B,{label:"Message (optional)",name:"message",placeholder:"Please describe your locksmith needs...",value:d.message,onChange:e=>A("message",e.target.value),error:p.message,rows:5}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:e=>{N(e.target.checked),p.consent&&u(e=>({...e,consent:void 0}))},className:"mt-0.5 h-4 w-4 rounded border-input text-primary focus:ring-primary focus:ring-offset-0"}),e.jsxs("span",{className:"text-sm text-muted-foreground leading-relaxed",children:["I agree to be contacted regarding my request and accept the"," ",e.jsx("button",{type:"button",onClick:()=>w("privacy"),className:"text-primary underline hover:text-primary/80 transition-colors",children:"Privacy Policy"})," ","and"," ",e.jsx("button",{type:"button",onClick:()=>w("terms"),className:"text-primary underline hover:text-primary/80 transition-colors",children:"Terms & Conditions"})]})]}),p.consent&&e.jsx("p",{className:"text-xs text-destructive ml-7",children:p.consent})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Protected by reCAPTCHA"}),e.jsx(P,{type:"submit",size:"lg",className:"w-full",disabled:h||!S,children:h?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"mr-2 h-5 w-5 animate-spin",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sending..."]}):"Request Free Estimate"})]}),e.jsx(z,{isOpen:null!==C,onClose:()=>w(null),type:C||"privacy"})]})}export{ae as default};